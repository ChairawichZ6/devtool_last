pipeline {
    agent any
        environment {
            DOCKER_CONTAINER_NAME_FRONTEND = "frontend_server"
            DOCKER_CONTAINER_NAME_BACKEND = "backend_server"
            DOCKER_IMAGE_NAME_FRONTEND     = "docfook55/my-frontend_image:1.0"
            DOCKER_IMAGE_NAME_BACKEND     = "docfook55/my-backend_image:1.0"
        }


        stages {
            stage('Initialize Stage') {
                steps {
                    echo 'Initial : Delete containers and images'
                    sh 'sudo docker stop ${DOCKER_CONTAINER_NAME_FRONTEND} || true'
                    sh 'sudo docker stop ${DOCKER_CONTAINER_NAME_BACKEND} || true'
                    sh 'sudo docker rm ${DOCKER_CONTAINER_NAME_FRONTEND} || true'
                    sh 'sudo docker rm ${DOCKER_CONTAINER_NAME_BACKEND} || true'
                    sh 'sudo docker rmi ${DOCKER_IMAGE_NAME_FRONTEND} || true'
                    sh 'sudo docker rmi ${DOCKER_IMAGE_NAME_BACKEND} || true'
                }
            }

            stage('Pull Stage') {
                steps {
                    dir('devtool_last') {
                        echo "Current path is ${pwd()}"
                        sh "sudo docker pull ${DOCKER_IMAGE_NAME_BACKEND}"
                        sh "sudo docker pull ${DOCKER_IMAGE_NAME_FRONTEND}"
                    }
                }
            }

            stage('Run Stage') {
                steps {
                    dir('devtool_last') {
                        echo "Current path is ${pwd()}"
                        sh "sudo docker run -d -p 8082:80 --name ${DOCKER_CONTAINER_NAME_BACKEND}  ${DOCKER_IMAGE_NAME_BACKEND}"
                        sh "sudo docker run -d -p 8081:80 --name ${DOCKER_CONTAINER_NAME_FRONTEND} ${DOCKER_IMAGE_NAME_FRONTEND}"
                    }
                }
            }
        
        }
}
